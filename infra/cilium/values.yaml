# Cilium Helm values for k3d cluster with Zero Trust

# Replace kube-proxy entirely
kubeProxyReplacement: true

# Note: k8sServiceHost is overridden dynamically by setup.sh for k3d
k8sServiceHost: k3d-ecrin-server-0
k8sServicePort: 6443

# Ingress Controller
ingressController:
  enabled: true
  default: true
  loadbalancerMode: shared
  service:
    type: NodePort
    insecureNodePort: 80
    secureNodePort: 443

# Enable Hubble for observability
hubble:
  enabled: true
  relay:
    enabled: true
  ui:
    enabled: true

# mTLS with SPIRE integration
authentication:
  enabled: true
  mutual:
    spire:
      enabled: true
      install:
        enabled: false # We install SPIRE separately for more control
      serverAddress: spire-server.spire.svc.cluster.local:8081
      trustDomain: ecrin.local

# Network Policy enforcement
policyEnforcementMode: default

# Enable L7 proxy for HTTP-aware policies
l7Proxy: true

# Enable identity-based security
identityAllocationMode: crd

# Operator settings
operator:
  replicas: 1

# IPAM configuration for k3d
ipam:
  mode: kubernetes

# Enable host firewall for additional security
hostFirewall:
  enabled: true

# Enable bandwidth manager
bandwidthManager:
  enabled: true

# Debug settings (can be disabled in prod)
debug:
  enabled: false
